<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matematika Kuis</title>
    <style>
        :root {
            --primary: #4a6bff;
            --secondary: #f5f7ff;
            --accent: #ff6b6b;
            --text: #333;
            --light-text: #666;
            --background: #fff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: var(--background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
        }

        .easy {
            background-color: #6bce70;
            color: white;
        }

        .medium {
            background-color: #f0ad4e;
            color: white;
        }

        .hard {
            background-color: #d9534f;
            color: white;
        }

        .extreme {
            background-color: #5d3a9b;
            color: white;
        }

        .settings-panel {
            background-color: var(--background);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .settings-title {
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .settings-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .quiz-container {
            display: none;
            background-color: var(--background);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .level-info {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question {
            font-size: 1.3rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-field {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            margin-bottom: 15px;
            transition: border 0.3s;
        }

        .answer-field:focus {
            border-color: var(--primary);
            outline: none;
        }

        .answer-options {
            display: none;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background-color: var(--secondary);
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .hint-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--light-text);
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hint-btn:hover {
            color: var(--primary);
        }

        .submit-btn {
            padding: 12px 25px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #3a5bed;
        }
        
        .clear-btn {
            background-color: #6c757d;
        }
        .clear-btn:hover {
            background-color: #5a6268;
        }

        .scratch-pad {
            margin-top: 30px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            height: 200px;
            width: 100%;
            background-color: white;
        }

        .stats-container {
            background-color: var(--background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: none;
        }

        .stats-title {
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background-color: var(--secondary);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .hint-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .hint-content {
            background-color: var(--background);
            padding: 25px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
        }

        .hint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .hint-title {
            color: var(--primary);
            font-size: 1.3rem;
        }

        .close-hint {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }

        .hint-text {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .hint-points {
            color: var(--accent);
            font-weight: bold;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .result-content {
            background-color: var(--background);
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .correct {
            color: #6bce70;
        }

        .incorrect {
            color: #d9534f;
        }

        .result-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .result-message {
            margin-bottom: 20px;
            color: var(--light-text);
            line-height: 1.5;
        }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .next-btn {
            background-color: var(--primary);
            color: white;
        }

        .next-btn:hover {
            background-color: #3a5bed;
        }

        .home-btn {
            background-color: #eee;
            color: var(--text);
        }

        .home-btn:hover {
            background-color: #ddd;
        }

        @media (max-width: 768px) {
            .difficulty-selector {
                flex-direction: column;
                align-items: center;
            }

            .difficulty-btn {
                width: 100%;
            }

            .answer-options {
                grid-template-columns: 1fr;
            }

            .quiz-controls {
                flex-direction: column;
                gap: 15px;
            }
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            .hint-btn {
                order: -1;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Matematika Kuis</h1>
            <p>Uji kemampuan matematika Anda dengan berbagai tingkat kesulitan!</p>
        </header>

        <div class="settings-panel">
            <h2 class="settings-title">Pengaturan</h2>
            <div class="settings-options">
                <label>
                    <span>Gunakan Opsi Jawaban:</span>
                    <label class="switch">
                        <input type="checkbox" id="useOptionsToggle">
                        <span class="slider"></span>
                    </label>
                </label>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn easy" data-difficulty="easy">Mudah</button>
            <button class="difficulty-btn medium" data-difficulty="medium">Menengah</button>
            <button class="difficulty-btn hard" data-difficulty="hard">Sulit</button>
            <button class="difficulty-btn extreme" data-difficulty="extreme">Ekstrem</button>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="quiz-header">
                <div class="level-info">
                    Level <span id="currentLevel">1</span>/20 - 
                    <span id="difficultyDisplay">Mudah</span>
                </div>
                <div class="score-container">
                    <span>Poin:</span>
                    <span class="score" id="currentScore">0</span>
                </div>
            </div>

            <div class="question-container">
                <div class="question" id="questionText"></div>
                
                <input type="text" class="answer-field" id="answerInput" placeholder="Masukkan jawaban Anda...">
                
                <div class="answer-options" id="answerOptions">
                    </div>
            </div>

            <div class="quiz-controls">
                <button class="hint-btn" id="hintBtn">
                    <span>ðŸ’¡</span> Tips (-5 poin)
                </button>
                <div class="action-buttons">
                    <button class="submit-btn clear-btn" id="clearCanvasBtn">Bersihkan</button>
                    <button class="submit-btn" id="submitBtn">Submit</button>
                </div>
            </div>

            <div class="scratch-pad" id="scratchPad"></div>
        </div>

        <div class="stats-container" id="statsContainer">
            <h2 class="stats-title">Statistik Permainan</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Waktu per Level</div>
                    <div class="stat-value" id="timePerLevel">0 detik</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Percobaan Gagal</div>
                    <div class="stat-value" id="failedAttempts">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Kecepatan</div>
                    <div class="stat-value" id="speedStat">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Tips Digunakan</div>
                    <div class="stat-value" id="hintsUsed">0</div>
                </div>
            </div>
        </div>
    </div>

    <div class="hint-modal" id="hintModal">
        <div class="hint-content">
            <div class="hint-header">
                <h3 class="hint-title">Tips Penyelesaian</h3>
                <button class="close-hint" id="closeHint">&times;</button>
            </div>
            <div class="hint-text" id="hintText"></div>
            <p>Anda akan kehilangan <span class="hint-points">5 poin</span> untuk melihat tips ini.</p>
        </div>
    </div>

    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <div class="result-icon correct" id="resultIcon">âœ“</div>
            <h3 class="result-title" id="resultTitle">Jawaban Benar!</h3>
            <p class="result-message" id="resultMessage"></p>
            <div class="result-actions">
                <button class="modal-btn home-btn" id="homeBtn">Beranda</button>
                <button class="modal-btn next-btn" id="nextBtn">Level Berikutnya</button>
            </div>
        </div>
    </div>

    <script>
        // Variabel global
        let currentDifficulty = '';
        let currentLevel = 1;
        let currentScore = 0;
        let useOptions = false;
        let hintsUsed = 0;
        let failedAttempts = 0;
        let levelStartTime = 0;
        let levelTimes = [];
        let currentQuestion = {};
        let canvas;
        let ctx;

        // Elemen DOM
        const quizContainer = document.getElementById('quizContainer');
        const difficultyDisplay = document.getElementById('difficultyDisplay');
        const currentLevelDisplay = document.getElementById('currentLevel');
        const currentScoreDisplay = document.getElementById('currentScore');
        const questionText = document.getElementById('questionText');
        const answerInput = document.getElementById('answerInput');
        const answerOptions = document.getElementById('answerOptions');
        const submitBtn = document.getElementById('submitBtn');
        const hintBtn = document.getElementById('hintBtn');
        const hintModal = document.getElementById('hintModal');
        const hintText = document.getElementById('hintText');
        const closeHint = document.getElementById('closeHint');
        const resultModal = document.getElementById('resultModal');
        const resultIcon = document.getElementById('resultIcon');
        const resultTitle = document.getElementById('resultTitle');
        const resultMessage = document.getElementById('resultMessage');
        const homeBtn = document.getElementById('homeBtn');
        const nextBtn = document.getElementById('nextBtn');
        const statsContainer = document.getElementById('statsContainer');
        const timePerLevelDisplay = document.getElementById('timePerLevel');
        const failedAttemptsDisplay = document.getElementById('failedAttempts');
        const speedStatDisplay = document.getElementById('speedStat');
        const hintsUsedDisplay = document.getElementById('hintsUsed');
        const scratchPad = document.getElementById('scratchPad');
        const useOptionsToggle = document.getElementById('useOptionsToggle');
        const clearCanvasBtn = document.getElementById('clearCanvasBtn');

        // Event Listeners
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', startQuiz);
        });

        submitBtn.addEventListener('click', checkAnswer);
        hintBtn.addEventListener('click', showHint);
        closeHint.addEventListener('click', () => hintModal.style.display = 'none');
        homeBtn.addEventListener('click', goHome);
        nextBtn.addEventListener('click', nextLevel);
        useOptionsToggle.addEventListener('change', toggleAnswerOptions);
        clearCanvasBtn.addEventListener('click', clearCanvas);

        function clearCanvas() {
            if (ctx && canvas) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }
        
        function initCanvas() {
            scratchPad.innerHTML = '';
            canvas = document.createElement('canvas');
            canvas.width = scratchPad.offsetWidth;
            canvas.height = scratchPad.offsetHeight;
            scratchPad.appendChild(canvas);
            
            ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd);
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            function draw(e) {
                if (!isDrawing) return;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            function stopDrawing() {
                isDrawing = false;
            }

            function getTouchPos(canvasDom, touchEvent) {
                const rect = canvasDom.getBoundingClientRect();
                return {
                    x: touchEvent.touches[0].clientX - rect.left,
                    y: touchEvent.touches[0].clientY - rect.top
                };
            }
            
            function handleTouchStart(e) {
                e.preventDefault();
                const touchPos = getTouchPos(canvas, e);
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touchPos.x,
                    clientY: touchPos.y
                });
                canvas.dispatchEvent(mouseEvent);
            }
            
            function handleTouchMove(e) {
                e.preventDefault();
                const touchPos = getTouchPos(canvas, e);
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touchPos.x,
                    clientY: touchPos.y
                });
                canvas.dispatchEvent(mouseEvent);
            }
            
            function handleTouchEnd(e) {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            }
        }

        // Fungsi untuk memulai kuis
        function startQuiz(e) {
            currentDifficulty = e.target.dataset.difficulty;
            currentLevel = 1;
            currentScore = 0;
            hintsUsed = 0;
            failedAttempts = 0;
            levelTimes = [];
            
            switch(currentDifficulty) {
                case 'easy':
                    difficultyDisplay.textContent = 'Mudah';
                    break;
                case 'medium':
                    difficultyDisplay.textContent = 'Menengah';
                    break;
                case 'hard':
                    difficultyDisplay.textContent = 'Sulit';
                    break;
                case 'extreme':
                    difficultyDisplay.textContent = 'Ekstrem';
                    break;
            }
            
            quizContainer.style.display = 'block';
            statsContainer.style.display = 'block';
            
            initCanvas();
            
            startLevel();
        }

        // Fungsi untuk memulai level
        function startLevel() {
            clearCanvas();
            
            currentLevelDisplay.textContent = currentLevel;
            currentScoreDisplay.textContent = currentScore;
            answerInput.value = '';
            answerInput.style.borderColor = '#ddd';
            
            currentQuestion = generateQuestion(currentDifficulty, currentLevel);
            questionText.textContent = currentQuestion.question;
            
            if (useOptions) {
                answerInput.style.display = 'none';
                answerOptions.style.display = 'grid';
                
                answerOptions.innerHTML = '';
                
                currentQuestion.options.forEach((option, index) => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'option-btn';
                    optionBtn.textContent = option;
                    optionBtn.dataset.value = option;
                    optionBtn.addEventListener('click', selectOption);
                    answerOptions.appendChild(optionBtn);
                });
            } else {
                answerInput.style.display = 'block';
                answerOptions.style.display = 'none';
            }
            
            levelStartTime = Date.now();
            
            updateStats();
        }

        function selectOption(e) {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.style.borderColor = '#ddd';
                btn.style.backgroundColor = 'white';
            });
            
            e.target.style.borderColor = 'var(--primary)';
            e.target.style.backgroundColor = 'var(--secondary)';
            
            answerInput.value = e.target.dataset.value;
        }

        function toggleAnswerOptions() {
            useOptions = useOptionsToggle.checked;
            
            if (quizContainer.style.display === 'block') {
                startLevel();
            }
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim();
            
            if (!userAnswer) {
                answerInput.style.borderColor = 'var(--accent)';
                return;
            }
            
            const timeSpent = Math.floor((Date.now() - levelStartTime) / 1000);
            levelTimes.push(timeSpent);
            
            let isCorrect = false;

            // Toleransi untuk jawaban desimal
            if (!isNaN(userAnswer) && typeof currentQuestion.answer === 'number') {
                 isCorrect = Math.abs(parseFloat(userAnswer) - currentQuestion.answer) < 0.01;
            } else {
                 isCorrect = userAnswer.toLowerCase() === currentQuestion.answer.toString().toLowerCase();
            }
            
            showResult(isCorrect, timeSpent);
        }

        function showResult(isCorrect, timeSpent) {
            if (isCorrect) {
                resultIcon.className = 'result-icon correct';
                resultIcon.textContent = 'âœ“';
                resultTitle.textContent = 'Jawaban Benar!';
                
                let maxPoints = 10;
                if (currentDifficulty === 'medium') maxPoints = 15;
                else if (currentDifficulty === 'hard') maxPoints = 20;
                else if (currentDifficulty === 'extreme') maxPoints = 25;
                
                maxPoints += Math.floor(currentLevel / 4);

                const timePenalty = Math.floor(timeSpent / 4);

                let pointsEarned = Math.max(1, maxPoints - timePenalty);
                
                resultMessage.innerHTML = `Poin dasar: ${maxPoints}<br>Pengurangan waktu: -${timePenalty}<br><b>Poin diperoleh: ${pointsEarned}</b>`;
                currentScore += pointsEarned;

            } else {
                resultIcon.className = 'result-icon incorrect';
                resultIcon.textContent = 'âœ—';
                resultTitle.textContent = 'Jawaban Salah!';
                resultMessage.innerHTML = `Jawaban yang benar adalah: <b>${currentQuestion.answer}</b>`;
                
                currentScore = Math.max(0, currentScore - 5);
                failedAttempts++;
            }
            
            currentScoreDisplay.textContent = currentScore;
            updateStats();
            resultModal.style.display = 'flex';
        }

        function showHint() {
            hintText.textContent = currentQuestion.hint;
            hintModal.style.display = 'flex';
            
            closeHint.onclick = function() {
                hintModal.style.display = 'none';
                
                if (!currentQuestion.hintUsed) {
                    currentScore = Math.max(0, currentScore - 5);
                    currentScoreDisplay.textContent = currentScore;
                    hintsUsed++;
                    updateStats();
                    currentQuestion.hintUsed = true;
                }
            };
        }

        function nextLevel() {
            resultModal.style.display = 'none';
            
            if (currentLevel < 20) {
                currentLevel++;
                startLevel();
            } else {
                quizCompleted();
            }
        }

        function quizCompleted() {
            resultTitle.textContent = 'Kuis Selesai!';
            resultMessage.textContent = `Total poin Anda: ${currentScore}`;
            nextBtn.style.display = 'none';
            resultModal.style.display = 'flex';
        }

        function goHome() {
            resultModal.style.display = 'none';
            quizContainer.style.display = 'none';
            statsContainer.style.display = 'none';
        }

        function updateStats() {
            if (levelTimes.length > 0) {
                const lastLevelTime = levelTimes[levelTimes.length - 1];
                timePerLevelDisplay.textContent = `${lastLevelTime} detik`;
            }
            
            failedAttemptsDisplay.textContent = failedAttempts;
            
            hintsUsedDisplay.textContent = hintsUsed;
            
            if (levelTimes.length > 0) {
                const avgTime = Math.round(levelTimes.reduce((a, b) => a + b, 0) / levelTimes.length);
                speedStatDisplay.textContent = `${avgTime} detik/level`;
            } else {
                 speedStatDisplay.textContent = `-`;
            }
        }

        // --- SISTEM PEMBUATAN SOAL BARU ---

        // Fungsi pembantu
        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const getGcd = (a, b) => b === 0 ? a : getGcd(b, a % b);
        const getLcm = (a, b) => (a * b) / getGcd(a, b);
        
        function getPrimeFactorization(num) {
            const factors = {};
            let divisor = 2;
            while (num >= 2) {
                if (num % divisor === 0) {
                    factors[divisor] = (factors[divisor] || 0) + 1;
                    num /= divisor;
                } else {
                    divisor++;
                }
            }
            return Object.entries(factors).map(([base, exp]) => exp > 1 ? `${base}^${exp}` : `${base}`).join(' Ã— ');
        }

        // BANK SOAL TINGKAT MUDAH (EASY)
        const easyQuestions = [
            () => {
                const a = randInt(10, 50);
                const b = randInt(10, 50);
                return { question: `Berapakah hasil dari ${a} + ${b}?`, answer: a + b, hint: "Jumlahkan kedua angka tersebut." };
            },
            () => {
                const a = randInt(5, 15);
                const b = randInt(2, 9);
                return { question: `Berapakah hasil dari ${a} Ã— ${b}?`, answer: a * b, hint: "Kalikan kedua angka tersebut." };
            },
            () => {
                const den1 = 2, den2 = 4, num1 = 1, num2 = 1;
                return { question: `Berapakah hasil dari 1/${den1} + 1/${den2}? (jawaban dalam desimal)`, answer: 0.75, hint: "Samakan penyebutnya terlebih dahulu." };
            },
            () => {
                const numbers = [randInt(1, 5) * 2, randInt(1, 5) * 2 + 1, randInt(6, 10) * 2 + 1];
                const answer = numbers[0];
                return { question: `Manakah bilangan genap dari: ${shuffleArray(numbers).join(', ')}?`, answer, hint: "Bilangan genap adalah bilangan yang habis dibagi 2." };
            },
            () => {
                const jam = randInt(1, 12);
                const tambahan = randInt(2, 6);
                const answer = (jam + tambahan) % 12 || 12;
                return { question: `Jika sekarang jam ${jam}, jam berapakah ${tambahan} jam lagi?`, answer, hint: "Tambahkan jam sekarang dengan durasi waktu." };
            },
            () => ({ question: `1 kilometer sama dengan berapa meter?`, answer: 1000, hint: "Kilo berarti seribu." }),
            () => {
                const sisi = randInt(4, 10);
                return { question: `Sebuah persegi memiliki sisi ${sisi} cm. Berapakah kelilingnya (cm)?`, answer: 4 * sisi, hint: "Keliling persegi adalah 4 kali panjang sisinya." };
            },
             () => {
                const romanMap = {1:'I', 4:'IV', 5:'V', 9:'IX', 10:'X'};
                const num = [1,4,5,9,10][randInt(0,4)];
                return { question: `Angka romawi dari ${num} adalah?`, answer: romanMap[num], hint: 'Ingat kembali simbol dasar angka romawi.' };
            }
        ];

        // BANK SOAL TINGKAT SEDANG (MEDIUM)
        const mediumQuestions = [
            () => {
                const a = randInt(5, 15), b = randInt(2, 5), c = randInt(3, 10);
                return { question: `Berapakah hasil dari ${a} + ${b} Ã— ${c}?`, answer: a + b * c, hint: "Kerjakan perkalian terlebih dahulu (aturan BODMAS/PEMDAS)." };
            },
            () => {
                const a = randInt(20, 50), b = randInt(100, 200);
                return { question: `${a}% dari ${b} adalah?`, answer: (a / 100) * b, hint: "Ubah persentase menjadi desimal (bagi 100), lalu kalikan." };
            },
            () => {
                const a = randInt(4, 10), b = randInt(11, 20);
                return { question: `KPK dari ${a} dan ${b} adalah?`, answer: getLcm(a, b), hint: "Kelipatan Persekutuan Terkecil." };
            },
            () => {
                const x = randInt(2, 10), b = randInt(5, 15);
                const c = x + b;
                return { question: `Jika x + ${b} = ${c}, berapakah nilai x?`, answer: x, hint: "Pindahkan angka ke sisi lain untuk menemukan nilai x." };
            },
            () => {
                const a = randInt(-15, -5), b = randInt(6, 20);
                return { question: `Berapakah hasil dari ${a} + ${b}?`, answer: a + b, hint: "Angka negatif ditambah positif sama dengan pengurangan." };
            },
            () => {
                const arr = [randInt(2, 5), randInt(6, 10), randInt(11, 15)];
                const answer = arr.reduce((sum, val) => sum + val, 0) / arr.length;
                return { question: `Berapakah rata-rata dari ${arr.join(', ')}?`, answer: parseFloat(answer.toFixed(2)), hint: "Jumlahkan semua angka lalu bagi dengan banyaknya angka." };
            },
            () => {
                const a = randInt(2, 6);
                const b = randInt(2, 5);
                return { question: `Berapakah hasil dari ${a}Â² + âˆš${b*b}?`, answer: a * a + b, hint: "Hitung pangkat dan akar terlebih dahulu, baru jumlahkan." };
            },
            () => ({ question: `Sudut yang besarnya kurang dari 90 derajat disebut sudut...?`, answer: "lancip", hint: "Lawan dari sudut tumpul." })
        ];

        // BANK SOAL TINGKAT SULIT (HARD)
        const hardQuestions = [
             () => {
                const x = randInt(2, 10);
                const a = randInt(2, 5), b = randInt(1, 10);
                const c = a * x + b;
                return { question: `Jika ${a}x + ${b} = ${c}, berapakah nilai x?`, answer: x, hint: "Isolasi variabel x untuk menemukan nilainya." };
            },
            () => {
                const num = randInt(20, 50);
                return { question: `Faktor prima dari ${num} adalah? (contoh: 2 x 3^2)`, answer: getPrimeFactorization(num), hint: "Bagi terus bilangan dengan bilangan prima terkecil." };
            },
            () => {
                const sisi = randInt(3, 7);
                return { question: `Volume sebuah kubus dengan panjang rusuk ${sisi} cm adalah? (cmÂ³)?`, answer: sisi * sisi * sisi, hint: "Volume kubus adalah rusuk pangkat tiga." };
            },
            () => {
                return { question: `Berapakah peluang munculnya angka genap pada lemparan sebuah dadu? (jawaban dalam desimal)`, answer: 0.5, hint: "Jumlah sisi genap dibagi total sisi." };
            },
            () => {
                const x = randInt(2, 5);
                const c = randInt(1, 5);
                return { question: `Jika f(x) = xÂ² - ${c}, berapakah nilai f(${x})?`, answer: x * x - c, hint: "Ganti semua x dalam fungsi dengan angka yang diberikan." };
            },
            () => {
                const base = randInt(2, 3);
                const start = base * randInt(1, 3);
                const sequence = [start, start * base, start * base * base, start * base * base * base];
                return { question: `Lanjutkan deret berikut: ${sequence.slice(0,3).join(', ')}, ...`, answer: sequence[3], hint: "Perhatikan rasio perkalian antar suku." };
            }
        ];

        // BANK SOAL TINGKAT EKSTREM (EXTREME)
        const extremeQuestions = [
            () => ({ question: "Berapakah hasil dari sin(30Â°) + cos(60Â°)? (dalam desimal)", answer: 1, hint: "Gunakan nilai dari sudut-sudut istimewa trigonometri." }),
            () => {
                const a = randInt(2, 5), b = randInt(2, 5);
                return { question: `Turunan dari f(x) = ${a}xÂ² + ${b}x adalah? (format: 12x+3)`, answer: `${2 * a}x+${b}`, hint: "Gunakan aturan pangkat: d/dx(ax^n) = n*ax^(n-1)." };
            },
            () => {
                const a = randInt(2, 4), b = randInt(3, 5);
                return { question: `Jika 2^${a} Ã— 2^${b} = 2^x, maka nilai x adalah?`, answer: a + b, hint: "Jika basisnya sama, pangkatnya dijumlahkan." };
            },
            () => {
                const a = randInt(1, 5), b = randInt(1, 5), c = randInt(1, 5), d = randInt(1, 5);
                const real = a + c;
                const imag = b - d;
                return { question: `Berapakah hasil dari (${a} + ${b}i) + (${c} - ${d}i)? (format: 5+3i)`, answer: `${real}+${imag}i`, hint: "Jumlahkan bagian riil dengan riil, dan imajiner dengan imajiner." };
            },
            () => {
                const a = randInt(1, 5), b = randInt(1, 5);
                const sum = a + b, prod = a * b;
                return { question: `Jika a + b = ${sum} dan ab = ${prod}, maka aÂ² + bÂ² = ?`, answer: a * a + b * b, hint: "Ingat bahwa (a+b)Â² = aÂ² + bÂ² + 2ab." };
            },
            () => ({ question: `Berapakah hasil dari integral âˆ«(2x) dx? (format: x^2+C)`, answer: "x^2+C", hint: "Gunakan aturan integral pangkat: âˆ«ax^n dx = (a/(n+1))x^(n+1) + C." })
        ];

        // Fungsi utama untuk generate soal
        function generateQuestion(difficulty) {
            let questionBank;
            switch(difficulty) {
                case 'easy':
                    questionBank = easyQuestions;
                    break;
                case 'medium':
                    questionBank = mediumQuestions;
                    break;
                case 'hard':
                    questionBank = hardQuestions;
                    break;
                case 'extreme':
                    questionBank = extremeQuestions;
                    break;
                default:
                    questionBank = easyQuestions;
            }

            // Pilih fungsi pembuat soal secara acak dari bank soal
            const questionGenerator = questionBank[Math.floor(Math.random() * questionBank.length)];
            const generated = questionGenerator();
            
            // Generate opsi jawaban jika diperlukan
            if (useOptions) {
                generated.options = generateOptions(generated.answer);
            }

            return generated;
        }

        function generateOptions(correctAnswer) {
            const options = [correctAnswer];
            const answerType = typeof correctAnswer;

            if (answerType === 'number') {
                const num = parseFloat(correctAnswer);
                let range = Math.max(5, Math.abs(num * 0.3));

                while (options.length < 4) {
                    let option;
                    const variation = (Math.random() * range) + 1;
                    
                    if (Math.random() > 0.5) {
                        option = num + variation;
                    } else {
                        option = num - variation;
                    }

                    option = Math.max(0, option); // Opsi tidak negatif
                    // Pembulatan agar opsi terlihat lebih rapi
                    option = Math.round(option * 100) / 100;
                    
                    if (!options.includes(option)) {
                        options.push(option);
                    }
                }
            } else { // Untuk jawaban teks
                 const similarOptions = [
                    correctAnswer.toString().split('').reverse().join(''), // Dibalik
                    correctAnswer.toString().toUpperCase(), // Huruf besar semua
                    "salah", // Opsi salah umum
                 ];
                 // Filter duplikat dan tambahkan ke opsi utama
                 similarOptions.forEach(opt => {
                    if(options.length < 4 && !options.includes(opt)){
                        options.push(opt);
                    }
                 });
                 // Jika masih kurang, tambahkan opsi acak
                 while(options.length < 4){
                    options.push(`opsi ${options.length +1}`);
                 }
            }
            
            return shuffleArray(options);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
